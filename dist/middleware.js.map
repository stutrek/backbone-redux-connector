{"version":3,"sources":["../src/middleware.js"],"names":["module","exports","vent","marionetteMiddleware","Backbone","Marionette","_","trigger","extend","Events","forEach","viewType","oldViewInitialize","prototype","initialize","listenTo","action","model","handleAction","__lastAction","collection","apply","arguments","oldAppStart","Application","start","next","reduxDispatchInProgress","reduxActionInProgress"],"mappings":";;AAAAA,OAAOC,OAAP,GAAiB,UAAUC,IAAV,EAAgB;AAChC,QAAO,SAASC,oBAAT,CAA+BC,QAA/B,EAAyCC,UAAzC,EAAqDC,CAArD,EAAwD;AAC9DJ,SAAOA,KAAKK,OAAL,GAAeL,IAAf,GAAsBI,EAAEE,MAAF,CAASN,IAAT,EAAeE,SAASK,MAAxB,CAA7B;;AAEA,GAAC,UAAD,EAAa,gBAAb,EAA+B,eAA/B,EAAgD,QAAhD,EAA0D,YAA1D,EAAwEC,OAAxE,CAAgF,UAAUC,QAAV,EAAoB;AACnG,OAAI,CAACN,WAAWM,QAAX,CAAL,EAA2B;AAC1B;AACA;AACA;AACD,OAAIC,oBAAoBP,WAAWM,QAAX,EAAqBE,SAArB,CAA+BC,UAAvD;AACAT,cAAWM,QAAX,EAAqBE,SAArB,CAA+BC,UAA/B,GAA4C,YAAY;AACvD,SAAKC,QAAL,CAAcb,IAAd,EAAoB,QAApB,EAA8B,UAAUc,MAAV,EAAkB;AAC/C,SAAI,KAAKC,KAAL,IAAc,KAAKA,KAAL,CAAWC,YAAzB,IAAyC,KAAKD,KAAL,CAAWE,YAAX,KAA4BH,MAAzE,EAAiF;AAChF,WAAKC,KAAL,CAAWC,YAAX,CAAwBF,MAAxB;AACA,WAAKC,KAAL,CAAWE,YAAX,GAA0BH,MAA1B;AACA;AACD,SAAI,KAAKI,UAAL,IAAmB,KAAKA,UAAL,CAAgBF,YAAnC,IAAmD,KAAKE,UAAL,CAAgBD,YAAhB,KAAiCH,MAAxF,EAAgG;AAC/F,WAAKI,UAAL,CAAgBF,YAAhB,CAA6BF,MAA7B;AACA,WAAKI,UAAL,CAAgBD,YAAhB,GAA+BH,MAA/B;AACA;AACD,KATD;;AAWAJ,sBAAkBS,KAAlB,CAAwB,IAAxB,EAA8BC,SAA9B;AACA,IAbD;AAcA,GApBD;;AAsBA,MAAIC,cAAclB,WAAWmB,WAAX,CAAuBX,SAAvB,CAAiCY,KAAnD;AACApB,aAAWmB,WAAX,CAAuBX,SAAvB,CAAiCY,KAAjC,GAAyC,YAAY;AACpD,QAAKV,QAAL,CAAcb,IAAd,EAAoB,QAApB,EAA8B,UAAUc,MAAV,EAAkB;AAC/C,QAAI,KAAKE,YAAL,IAAqB,KAAKC,YAAL,KAAsBH,MAA/C,EAAuD;AACtD,UAAKE,YAAL,CAAkBF,MAAlB;AACA,UAAKG,YAAL,GAAoBH,MAApB;AACA;AACD,IALD;;AAOAO,eAAYF,KAAZ,CAAkB,IAAlB,EAAwBC,SAAxB;AACA,GATD;;AAWA,SAAO,YAAY;AAClB,UAAO,UAAUI,IAAV,EAAgB;AACtB,WAAO,UAAUV,MAAV,EAAkB;AACxB,SAAId,KAAKyB,uBAAL,IAAgCzB,KAAK0B,qBAAzC,EAAgE;AAC/DF,WAAKV,MAAL;AACA;AACA;AACDd,UAAK0B,qBAAL,GAA6BZ,MAA7B;AACAd,UAAKK,OAAL,CAAa,QAAb,EAAuBS,MAAvB;AACAd,UAAK0B,qBAAL,GAA6B,KAA7B;AACAF,UAAKV,MAAL;AACA,KATD;AAUA,IAXD;AAYA,GAbD;AAcA,EAnDD;AAoDA,CArDD","file":"middleware.js","sourcesContent":["module.exports = function (vent) {\n\treturn function marionetteMiddleware (Backbone, Marionette, _) {\n\t\tvent = vent.trigger ? vent : _.extend(vent, Backbone.Events);\n\n\t\t['ItemView', 'CollectionView', 'CompositeView', 'Layout', 'LayoutView'].forEach(function (viewType) {\n\t\t\tif (!Marionette[viewType]) {\n\t\t\t\t// the name Layout was changed to LayoutView\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar oldViewInitialize = Marionette[viewType].prototype.initialize;\n\t\t\tMarionette[viewType].prototype.initialize = function () {\n\t\t\t\tthis.listenTo(vent, 'action', function (action) {\n\t\t\t\t\tif (this.model && this.model.handleAction && this.model.__lastAction !== action) {\n\t\t\t\t\t\tthis.model.handleAction(action);\n\t\t\t\t\t\tthis.model.__lastAction = action;\n\t\t\t\t\t}\n\t\t\t\t\tif (this.collection && this.collection.handleAction && this.collection.__lastAction !== action) {\n\t\t\t\t\t\tthis.collection.handleAction(action);\n\t\t\t\t\t\tthis.collection.__lastAction = action;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\toldViewInitialize.apply(this, arguments);\n\t\t\t};\n\t\t});\n\n\t\tvar oldAppStart = Marionette.Application.prototype.start;\n\t\tMarionette.Application.prototype.start = function () {\n\t\t\tthis.listenTo(vent, 'action', function (action) {\n\t\t\t\tif (this.handleAction && this.__lastAction !== action) {\n\t\t\t\t\tthis.handleAction(action);\n\t\t\t\t\tthis.__lastAction = action;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\toldAppStart.apply(this, arguments);\n\t\t};\n\n\t\treturn function () {\n\t\t\treturn function (next) {\n\t\t\t\treturn function (action) {\n\t\t\t\t\tif (vent.reduxDispatchInProgress || vent.reduxActionInProgress) {\n\t\t\t\t\t\tnext(action);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvent.reduxActionInProgress = action;\n\t\t\t\t\tvent.trigger('action', action);\n\t\t\t\t\tvent.reduxActionInProgress = false;\n\t\t\t\t\tnext(action);\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\t};\n}\n"]}